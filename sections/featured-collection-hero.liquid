{% comment %}
  Featured Collection Hero – Mobil Uyumluluk + Tek Kart Kaydırma + Farklı SVG
{% endcomment %}

<div class="featured-collection-hero"
     x-data="{
      activeSlide: 0,
      totalSlides: 5,
      productsPerView: 1.3,
      slideWidth: 0,

      get canScrollNext() { return this.activeSlide < this.totalSlides - 1 },
      get canScrollPrev() { return this.activeSlide > 0 },

      goNext() { if (this.canScrollNext) { this.activeSlide++; this.scrollToActive(); } },
      goPrev() { if (this.canScrollPrev) { this.activeSlide--; this.scrollToActive(); } },
      scrollToActive() {
        this.$refs.carousel.scrollTo({
          left: this.slideWidth * this.activeSlide,
          behavior: 'smooth'
        })
      },
      updateLayout() {
        const w = window.innerWidth
        if (w < 640)      this.productsPerView = 1.3
        else if (w < 768) this.productsPerView = 2
        else              this.productsPerView = 2.5

        const first = this.$refs.firstSlide
        if (first) {
          const s = getComputedStyle(first)
          this.slideWidth = first.offsetWidth + parseFloat(s.marginLeft) + parseFloat(s.marginRight)
        }
      },

      init() {
        this.$nextTick(() => {
          this.updateLayout()
          window.addEventListener('resize', () => {
            this.updateLayout()
            this.scrollToActive()
          })
        })
      }
    }"
>

    <div class="w-full overflow-hidden">
        <div class="grid grid-cols-1 md:grid-cols-2 h-auto md:h-screen">

            <div class="relative w-full h-[60vh] sm:h-screen md:h-screen overflow-hidden">
                {% if section.settings.image != blank %}
                    <img
                            src="{{ section.settings.image }}"
                            alt="{{ section.settings.image.alt | escape }}"
                            class="absolute inset-0 w-full h-full object-cover"
                            loading="lazy"
                    >
                {% else %}
                    <img
                            src="{{ 'icon-eye.svg' | asset_url }}"
                            alt="Placeholder image"
                            class="absolute inset-0 w-full h-full object-cover bg-gray-100"
                    >
                {% endif %}
            </div>

            <div class="flex flex-col mt-2 justify-start md:mt-12 px-4 sm:px-6 py-8">
                <div class="mb-8 md:mt-10 -mt-[16rem] z-10 text-black md:text-black max-w-sm md:max-w-none">
                    {% if section.settings.heading != blank %}
                        <h2 class="text-2xl md:text-5xl font-bold md:text-black text-white md:w-[35rem] w-[20rem] mb-4">{{ section.settings.heading }}</h2>
                    {% endif %}
                    {% if section.settings.text != blank %}
                        <div class="text-gray-600  text-base md:mt-12 mb-12 hidden md:block md:text-xl md:w-[35rem]">{{ section.settings.text }}</div>
                    {% endif %}
                    {% if section.settings.button_label != blank and section.settings.button_link != blank %}
                        <a href="{{ section.settings.button_link }}"
                           class="inline-block border-b-2 border-white  md:border-black md:mb-12 pb-1 md:text-black text-white font-medium hover:opacity-80 transition-opacity">
                            {{ section.settings.button_label }}
                        </a>
                    {% endif %}
                </div>

                <div class="relative w-full">

                    <div class="overflow-x-auto overflow-y-hidden scroll-smooth scrollbar-hide"
                         x-ref="carousel"
                         x-on:wheel.passive>
                        <div class="flex w-max"
                             :style="`width: ${(100 / productsPerView) * totalSlides}%`">

                            {%- assign product_titles = "Organic Skinny High Waist Raw Hem Jeans,Organic Skinny High Waist Raw Hem Jeans,Organic Skinny High Waist Raw Hem Jeans,Organic Skinny High Waist Raw Hem Jeans,Organic Skinny High Waist Raw Hem Jeans" | split: "," -%}

                            {% for title in product_titles %}
                                <div class="w-[10rem] sm:w-[12rem] md:w-[20%] px-2 flex-shrink-0"
                                     {% if forloop.first %}x-ref="firstSlide"{% endif %}>

                                    <div class="bg-gray-100 rounded-lg overflow-hidden mb-3 h-[14rem] sm:h-[18rem] flex items-center justify-center">
                                        {% case forloop.index %}
                                            {% when 1 %}{% assign icon_svg = 'icon-eye-1.svg' %}
                                            {% when 2 %}{% assign icon_svg = 'icon-eye-2.svg' %}
                                            {% when 3 %}{% assign icon_svg = 'icon-eye-3.svg' %}
                                            {% when 4 %}{% assign icon_svg = 'icon-eye-1.svg' %}
                                            {% when 5 %}{% assign icon_svg = 'icon-eye-2.svg' %}


                                            {% else %}{% assign icon_svg = 'icon-eye.svg' %}
                                        {% endcase %}
                                        <img src="{{ icon_svg | asset_url }}"
                                             alt="{{ title }}"
                                             class="w-full h-full object-cover">
                                    </div>

                                    <h3 class="text-xs font-medium mb-1 text-start">{{ title }}</h3>
                                    <div class="flex flex-col sm:flex-row sm:justify-between items-start sm:items-center text-xs">
                                        <span class="font-medium">$99.99</span>
                                        <div class="flex space-x-1 mt-1 sm:mt-0">
                                            <span class="w-3 h-3 rounded-full bg-[#99C3CC]"></span>
                                            <span class="w-3 h-3 rounded-full bg-[#CC9999]"></span>
                                            <span class="w-3 h-3 rounded-full bg-[#CB99CC]"></span>
                                            <span class="w-3 h-3 rounded-full bg-[#A6CC99]"></span>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>


                    <button class="absolute top-1/2 left-2 transform -translate-y-1/2 bg-white p-2 rounded-full shadow z-10"
                            x-show="canScrollPrev"
                            x-on:click="goPrev">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <button class="absolute top-1/2 right-2 transform -translate-y-1/2 bg-white p-2 rounded-full shadow z-10"
                            x-show="canScrollNext"
                            x-on:click="goNext">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>

                <div class="flex justify-center mt-4 space-x-2 md:hidden">
                    <template x-for="(dot, index) in totalSlides" :key="index">
                        <button class="w-2 h-2 rounded-full"
                                :class="index === activeSlide ? 'bg-black' : 'bg-gray-300'"
                                x-on:click="activeSlide = index; scrollToActive()"></button>
                    </template>
                </div>
            </div>
        </div>
    </div>
</div>

{% schema %}
{
  "name": "Featured Collection Hero",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "image_picker", "id": "image", "label": "Hero Image" },
    { "type": "text", "id": "badge_text", "label": "Badge Text", "default": "New Collection" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Everyday items, we have something to suit every occasion." },
    { "type": "richtext", "id": "text", "label": "Text", "default": "<p>At suspendisse augue lectus arcu, accumsan ut sit posuere vitae sit tincidunt semper eu proin leo gravida cursus.</p>" },
    { "type": "text", "id": "button_label", "label": "Button Label", "default": "Shop All Everyday Items" },
    { "type": "url", "id": "button_link", "label": "Button Link" }
  ],
  "presets": [ { "name": "Featured Collection Hero" } ]
}
{% endschema %}
